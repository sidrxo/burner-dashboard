(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[634],{27737:(e,t,s)=>{"use strict";s.d(t,{E:()=>i});var a=s(95155),r=s(53999);function i(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"skeleton",className:(0,r.cn)("bg-accent animate-pulse rounded-md",t),...s})}},41397:(e,t,s)=>{"use strict";s.d(t,{k:()=>n});var a=s(95155);s(12115);var r=s(55863),i=s(53999);function n(e){let{className:t,value:s,...n}=e;return(0,a.jsx)(r.bL,{"data-slot":"progress",className:(0,i.cn)("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",t),...n,children:(0,a.jsx)(r.C1,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:"translateX(-".concat(100-(s||0),"%)")}})})}},44396:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>B});var a=s(95155),r=s(93161),i=s(12115),n=s(35317),l=s(98915),d=s(77505),o=s(54786),c=s(56671),u=s(88482),m=s(88145),x=s(53999),v=s(99840),h=s(27737),g=s(16559);function p(e){let{className:t,...s}=e;return(0,a.jsx)("textarea",{"data-slot":"textarea",className:(0,x.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...s})}var f=s(82714),j=s(67820),b=s(5196);function N(e){let{className:t,...s}=e;return(0,a.jsx)(j.bL,{"data-slot":"checkbox",className:(0,x.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:(0,a.jsx)(j.C1,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,a.jsx)(b.A,{className:"size-3.5"})})})}var w=s(41397),y=s(76037),k=s(97168),E=s(89852),F=s(84616),A=s(69074),C=s(38564),S=s(14186),I=s(4516),T=s(17580),D=s(13717),U=s(8804),R=s(62525),z=s(85339);function J(){return(0,a.jsxs)(u.Zp,{className:"overflow-hidden group",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(h.E,{className:"h-56 w-full"}),(0,a.jsx)("div",{className:"absolute top-4 left-4",children:(0,a.jsx)(h.E,{className:"h-6 w-20 rounded-full"})})]}),(0,a.jsxs)(u.Wu,{className:"p-6 space-y-4",children:[(0,a.jsx)(h.E,{className:"h-6 w-3/4"}),(0,a.jsx)(h.E,{className:"h-4 w-full"}),(0,a.jsx)(h.E,{className:"h-4 w-2/3"}),(0,a.jsxs)("div",{className:"flex justify-between items-center pt-2",children:[(0,a.jsx)(h.E,{className:"h-8 w-20"}),(0,a.jsx)(h.E,{className:"h-4 w-16"})]})]})]})}function L(e){let{user:t}=e;return(0,a.jsxs)(u.Zp,{className:"max-w-md mx-auto mt-10",children:[(0,a.jsx)(u.aR,{children:(0,a.jsx)("h2",{className:"text-xl font-bold text-center",children:"Access Denied"})}),(0,a.jsx)(u.Wu,{children:(0,a.jsxs)("div",{className:"text-center space-y-2",children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"You don't have permission to view events."}),(0,a.jsxs)("div",{className:"text-sm bg-muted p-2 rounded",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Your role:"})," ",null==t?void 0:t.role]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Required roles:"})," siteAdmin, venueAdmin, or subAdmin"]}),(null==t?void 0:t.venueId)&&(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Your venue:"})," ",t.venueId]})]})]})})]})}function M(e){let{openForm:t,setOpenForm:s,editing:r,setEditing:i,user:n,venues:l,setEvents:d}=e;return(0,a.jsxs)(v.lG,{open:t,onOpenChange:s,children:[(0,a.jsx)(v.zM,{asChild:!0,children:(0,a.jsxs)(k.$,{onClick:()=>i(null),size:"lg",className:"shadow-md",children:[(0,a.jsx)(F.A,{className:"mr-2 h-4 w-4"}),"Create Event"]})}),(0,a.jsxs)(v.Cf,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)(v.c7,{children:(0,a.jsx)(v.L3,{children:r?"Edit Event":"Create New Event"})}),(0,a.jsx)(_,{existing:r,user:n,venues:l,onClose:()=>s(!1),onSaved:e=>{d(t=>{let s=t.filter(t=>t.id!==e.id);return[e,...s].sort((e,t)=>Number(!!t.isFeatured)-Number(!!e.isFeatured))})}})]})]})}function P(e){let{search:t,setSearch:s,events:r}=e;return(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-start sm:items-center",children:[(0,a.jsx)("div",{className:"relative max-w-sm w-full",children:(0,a.jsx)(E.p,{placeholder:"Search events...",value:t,onChange:e=>s(e.target.value),className:"pl-4 pr-4 h-11 border-2 focus:border-primary/50 transition-colors"})}),(0,a.jsxs)("div",{className:"flex gap-4 text-sm text-muted-foreground",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,a.jsxs)("span",{children:[r.length," Total"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),(0,a.jsxs)("span",{children:[r.filter(e=>e.isFeatured).length," Featured"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),(0,a.jsxs)("span",{children:[r.filter(e=>e.ticketsSold>=e.maxTickets).length," Sold Out"]})]})]})]})}function G(e){let{search:t,setOpenForm:s,userRole:r}=e;return(0,a.jsx)("div",{className:"col-span-full",children:(0,a.jsxs)(u.Zp,{className:"p-12 text-center border-dashed border-2",children:[(0,a.jsx)(A.A,{className:"mx-auto h-16 w-16 text-muted-foreground/50 mb-6"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-3",children:"No events found"}),(0,a.jsx)("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:t?"Try adjusting your search terms to find what you're looking for":"siteAdmin"===r?"Create your first event to get started with managing your events":"Create your first event for your venue to get started"}),!t&&(0,a.jsxs)(k.$,{onClick:()=>s(!0),size:"lg",children:[(0,a.jsx)(F.A,{className:"mr-2 h-4 w-4"}),"Create Your First Event"]})]})})}function O(e){let{ev:t,index:s,eventStatus:r,ticketProgress:i,user:n,onToggleFeatured:l,onDelete:d,setEditing:o,setOpenForm:c}=e;return(0,a.jsxs)(u.Zp,{className:"overflow-hidden group hover:shadow-xl transition-all duration-300 border-0 shadow-md bg-gradient-to-br from-background to-background/50",children:[(0,a.jsxs)("div",{className:"relative overflow-hidden",children:[t.imageUrl?(0,a.jsxs)("div",{className:"relative h-56 overflow-hidden",children:[(0,a.jsx)("img",{src:t.imageUrl,alt:t.name,className:"w-full h-full object-cover transition-transform duration-300"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent"})]}):(0,a.jsx)("div",{className:"h-56 bg-gradient-to-br from-muted via-muted/50 to-muted/30 flex items-center justify-center",children:(0,a.jsx)(A.A,{className:"h-16 w-16 text-muted-foreground/30"})}),(0,a.jsxs)("div",{className:"flex gap-2 p-4 pt-4 pb-0",children:[t.isFeatured&&(0,a.jsxs)(m.E,{className:"bg-yellow-500/90 text-white border-0 shadow-lg backdrop-blur-sm",children:[(0,a.jsx)(C.A,{className:"h-3 w-3 mr-1 fill-current"}),"Featured"]}),(0,a.jsx)(m.E,{variant:r.variant,className:"backdrop-blur-sm shadow-lg border-0",children:r.label})]}),(0,a.jsx)("div",{className:"absolute top-4 right-4",children:(0,a.jsx)(m.E,{className:"bg-background/90 text-foreground border shadow-lg backdrop-blur-sm text-lg font-bold px-3 py-1",children:(0,x.vv)(t.price)})})]}),(0,a.jsxs)(u.Wu,{className:"p-6 space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-xl font-bold leading-tight line-clamp-2 group-hover:text-primary transition-colors",children:t.name||"Untitled Event"}),t.description&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-3 leading-relaxed",children:t.description})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[t.date&&(0,a.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,a.jsx)("div",{className:"p-2 bg-primary/10 rounded-lg",children:(0,a.jsx)(S.A,{className:"h-4 w-4 text-primary"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:new Date(1e3*t.date.seconds).toLocaleDateString("en-GB",{weekday:"short",month:"short",day:"numeric"})}),(0,a.jsx)("div",{className:"text-muted-foreground text-xs",children:new Date(1e3*t.date.seconds).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-500/10 rounded-lg",children:(0,a.jsx)(I.A,{className:"h-4 w-4 text-blue-600"})}),(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"font-medium truncate",children:t.venue||"Venue TBA"})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(T.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("span",{className:"font-medium",children:[t.ticketsSold||0," / ",t.maxTickets||0," tickets"]})]}),(0,a.jsxs)("div",{className:"text-muted-foreground",children:[Math.round(i),"% sold"]})]}),(0,a.jsx)("div",{className:"w-full bg-muted rounded-full h-2 overflow-hidden",children:(0,a.jsx)("div",{className:"h-full rounded-full transition-all duration-500 ".concat(i>=100?"bg-red-500":i>=80?"bg-yellow-500":"bg-green-500"),style:{width:"".concat(i,"%")}})})]})]}),(0,a.jsx)(y.w,{}),(0,a.jsx)(u.wL,{className:"p-4 bg-muted/30",children:(0,a.jsxs)("div",{className:"flex gap-2 w-full",children:[(0,a.jsxs)(k.$,{variant:"outline",size:"sm",onClick:()=>{o(t),c(!0)},className:"flex-1 hover:bg-primary hover:text-primary-foreground transition-colors",children:[(0,a.jsx)(D.A,{className:"h-3 w-3 mr-2"}),"Edit"]}),"siteAdmin"===n.role&&(0,a.jsx)(k.$,{variant:"outline",size:"sm",onClick:()=>l(t),className:"flex-1 transition-colors ".concat((t.isFeatured,"hover:bg-yellow-500 hover:text-white")),children:t.isFeatured?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(U.A,{className:"h-3 w-3 mr-2"}),"Unfeature"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.A,{className:"h-3 w-3 mr-2"}),"Feature"]})}),(0,a.jsxs)(g.Lt,{children:[(0,a.jsx)(g.tv,{asChild:!0,children:(0,a.jsx)(k.$,{variant:"outline",size:"sm",className:"hover:bg-destructive hover:text-destructive-foreground transition-colors",children:(0,a.jsx)(R.A,{className:"h-3 w-3"})})}),(0,a.jsxs)(g.EO,{children:[(0,a.jsxs)(g.wd,{children:[(0,a.jsxs)(g.r7,{className:"flex items-center gap-2",children:[(0,a.jsx)(z.A,{className:"h-5 w-5 text-destructive"}),"Delete Event"]}),(0,a.jsxs)(g.$v,{children:['Are you sure you want to delete "',t.name,'"? This will also remove all associated tickets and cannot be undone.']})]}),(0,a.jsxs)(g.ck,{children:[(0,a.jsx)(g.Zr,{children:"Cancel"}),(0,a.jsx)(g.Rx,{onClick:()=>d(t),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete Event"})]})]})]})]})})]},"event-".concat(t.id,"-").concat(s))}function _(e){let{existing:t,user:s,venues:r,onSaved:o,onClose:u}=e,{form:m,setForm:x,file:v,setFile:h,progress:g,saving:j,onSubmit:b,resetPasswordForm:F,isEdit:A}=function(e,t,s,a,r){var o,u,m,x,v,h,g;let p=!!e,[f,j]=(0,i.useState)({id:null!=(o=null==e?void 0:e.id)?o:"",name:null!=(u=null==e?void 0:e.name)?u:"",description:null!=(m=null==e?void 0:e.description)?m:"",venue:null!=(x=null==e?void 0:e.venue)?x:"",venueId:null!=(v=null==e?void 0:e.venueId)?v:"siteAdmin"===t.role?"":t.venueId||"",datetime:(null==e?void 0:e.date)?new Date(1e3*e.date.seconds).toISOString().slice(0,16):"",price:null!=(h=null==e?void 0:e.price)?h:0,maxTickets:null!=(g=null==e?void 0:e.maxTickets)?g:0,isFeatured:"siteAdmin"===t.role&&!!(null==e?void 0:e.isFeatured)}),[b,N]=(0,i.useState)(null),[w,y]=(0,i.useState)(0),[k,E]=(0,i.useState)(!1);async function F(t){var s;if(!b)return null!=(s=null==e?void 0:e.imageUrl)?s:null;if(!["image/jpeg","image/jpg","image/png","image/gif"].includes(b.type))throw Error("Invalid file type");if(b.size>5242880)throw Error("File too large (max 5MB)");let a="event-images/".concat(t,"/").concat(Date.now(),"_").concat(b.name),r=(0,d.KR)(l.I,a),i=(0,d.bp)(r,b),n=await new Promise((e,t)=>{i.on("state_changed",e=>y(e.bytesTransferred/e.totalBytes*100),t,async()=>e(await (0,d.qk)(i.snapshot.ref)))});if((null==e?void 0:e.imageUrl)&&e.imageUrl!==n)try{await (0,d.XR)((0,d.KR)(l.I,e.imageUrl))}catch(e){}return n}async function A(i){i.preventDefault();try{if(E(!0),!f.name||!f.datetime)throw Error("Please fill all required fields");let i="",m="";if("siteAdmin"===t.role){if(!f.venueId)throw Error("Please select a venue");i=f.venueId;let e=s.find(e=>e.id===f.venueId);m=(null==e?void 0:e.name)||"Unknown Venue"}else{if(!t.venueId)throw Error("No venue assigned to your account");i=t.venueId;try{let e=await (0,n.x7)((0,n.H9)(l.db,"venues",t.venueId));m=e.exists()?e.data().name:"Unknown Venue"}catch(e){m="Unknown Venue"}}let x=n.Dc.fromDate(new Date(f.datetime));if(p){var d,o,u;let s=await F(e.id),r={id:e.id,name:f.name,description:f.description,venue:m,venueId:i,datetime:f.datetime,price:Number(f.price),maxTickets:Number(f.maxTickets),isFeatured:"siteAdmin"===t.role?f.isFeatured:null!=(d=null==e?void 0:e.isFeatured)&&d,date:x,imageUrl:null!=(o=null!=s?s:null==e?void 0:e.imageUrl)?o:null,ticketsSold:null!=(u=e.ticketsSold)?u:0},v={name:r.name,venue:r.venue,venueId:r.venueId,date:r.date,price:r.price,maxTickets:r.maxTickets,description:r.description||null,ticketsSold:r.ticketsSold,...s?{imageUrl:s}:{},updatedAt:n.Dc.now()};"siteAdmin"===t.role&&(v.isFeatured=r.isFeatured),await (0,n.mZ)((0,n.H9)(l.db,"events",e.id),v),a(r),c.oR.success("Event updated successfully")}else{if(!f.id.trim())throw Error("Event ID is required");let e=await F(f.id),s={id:f.id,name:f.name,description:f.description,venue:m,venueId:i,datetime:f.datetime,price:Number(f.price),maxTickets:Number(f.maxTickets),isFeatured:"siteAdmin"===t.role&&f.isFeatured,date:x,imageUrl:null!=e?e:null,ticketsSold:0};await (0,n.BN)((0,n.H9)(l.db,"events",f.id),{name:s.name,venue:s.venue,venueId:s.venueId,date:s.date,price:s.price,maxTickets:s.maxTickets,isFeatured:s.isFeatured,description:s.description||null,imageUrl:s.imageUrl,ticketsSold:0,createdAt:n.Dc.now(),createdBy:t.uid}),a(s),c.oR.success("Event created successfully")}r()}catch(e){c.oR.error(e.message||"Save failed")}finally{E(!1),y(0)}}return{form:f,setForm:j,file:b,setFile:N,progress:w,saving:k,onSubmit:A,resetPasswordForm:()=>{var s,a,r,i,n,l,d;j({id:null!=(s=null==e?void 0:e.id)?s:"",name:null!=(a=null==e?void 0:e.name)?a:"",description:null!=(r=null==e?void 0:e.description)?r:"",venue:null!=(i=null==e?void 0:e.venue)?i:"",venueId:null!=(n=null==e?void 0:e.venueId)?n:"siteAdmin"===t.role?"":t.venueId||"",datetime:(null==e?void 0:e.date)?new Date(1e3*e.date.seconds).toISOString().slice(0,16):"",price:null!=(l=null==e?void 0:e.price)?l:0,maxTickets:null!=(d=null==e?void 0:e.maxTickets)?d:0,isFeatured:"siteAdmin"===t.role&&!!(null==e?void 0:e.isFeatured)}),N(null),y(0)},isEdit:p}}(t,s,r,o,u);return(0,a.jsxs)("form",{className:"space-y-4",onSubmit:b,children:[!A&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(f.J,{htmlFor:"id",children:"Event ID *"}),(0,a.jsx)(E.p,{id:"id",value:m.id,onChange:e=>x(t=>({...t,id:e.target.value})),placeholder:"unique-event-id",required:!0})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(f.J,{htmlFor:"name",children:"Event Name *"}),(0,a.jsx)(E.p,{id:"name",value:m.name,onChange:e=>x(t=>({...t,name:e.target.value})),placeholder:"Summer Music Festival",required:!0})]}),"siteAdmin"===s.role&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(f.J,{htmlFor:"venue-select",children:"Venue *"}),(0,a.jsxs)("select",{id:"venue-select",className:"w-full p-2 border border-input bg-background rounded-md",value:m.venueId,onChange:e=>x(t=>({...t,venueId:e.target.value})),required:!0,children:[(0,a.jsx)("option",{value:"",children:"Select a venue"}),r.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(f.J,{htmlFor:"desc",children:"Description"}),(0,a.jsx)(p,{id:"desc",value:m.description,onChange:e=>x(t=>({...t,description:e.target.value})),placeholder:"Brief description of your event...",rows:3}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground text-right",children:[m.description.length," / 390 characters"]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(f.J,{htmlFor:"dt",children:"Date & Time *"}),(0,a.jsx)(E.p,{id:"dt",type:"datetime-local",value:m.datetime,onChange:e=>x(t=>({...t,datetime:e.target.value})),required:!0})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(f.J,{children:"Ticket Price (\xa3) *"}),(0,a.jsx)(E.p,{type:"number",step:"0.01",min:"0",value:m.price,onChange:e=>x(t=>({...t,price:Number(e.target.value)})),placeholder:"25.00",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(f.J,{children:"Maximum Tickets *"}),(0,a.jsx)(E.p,{type:"number",min:"1",value:m.maxTickets,onChange:e=>x(t=>({...t,maxTickets:Number(e.target.value)})),placeholder:"100",required:!0})]})]}),"siteAdmin"===s.role&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(N,{id:"featured",checked:m.isFeatured,onCheckedChange:e=>x(t=>({...t,isFeatured:!!e}))}),(0,a.jsx)(f.J,{htmlFor:"featured",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Mark as featured event"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(f.J,{htmlFor:"img",children:"Event Image"}),(0,a.jsx)(E.p,{id:"img",type:"file",accept:"image/*",onChange:e=>{var t,s;return h(null!=(s=null==(t=e.target.files)?void 0:t[0])?s:null)}}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Supported formats: JPEG, PNG, GIF (max 5MB)"}),g>0&&g<100&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(w.k,{value:g}),(0,a.jsxs)("div",{className:"text-xs text-center text-muted-foreground",children:["Uploading... ",Math.round(g),"%"]})]})]}),(0,a.jsx)(y.w,{}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,a.jsx)(k.$,{type:"button",variant:"outline",onClick:u,children:"Cancel"}),(0,a.jsx)(k.$,{type:"button",variant:"outline",onClick:F,disabled:j,children:"Reset"}),(0,a.jsx)(k.$,{type:"submit",disabled:j,children:j?"Saving...":A?"Update Event":"Create Event"})]})]})}function q(){let{user:e,authLoading:t,events:s,venues:r,loading:u,search:m,setSearch:x,filtered:v,onToggleFeatured:h,onDelete:g,getEventStatus:p,getTicketProgress:f,setEvents:j}=function(){let{user:e,loading:t}=(0,o.A)(),[s,a]=(0,i.useState)([]),[r,u]=(0,i.useState)([]),[m,x]=(0,i.useState)(!0),[v,h]=(0,i.useState)("");(0,i.useEffect)(()=>{!t&&e&&(p(),"siteAdmin"===e.role&&g())},[e,t]);let g=async()=>{try{let e=await (0,n.GG)((0,n.rJ)(l.db,"venues")),t=[];e.forEach(e=>{t.push({id:e.id,name:e.data().name})}),u(t)}catch(e){console.error("Error loading venues:",e),c.oR.error("Failed to load venues")}},p=async()=>{if(e){x(!0);try{let t;if("siteAdmin"===e.role)t=(0,n.P)((0,n.rJ)(l.db,"events"),(0,n.My)("createdAt","desc"));else if("venueAdmin"===e.role||"subAdmin"===e.role){if(!e.venueId){c.oR.error("No venue assigned to your account"),a([]),x(!1);return}t=(0,n.P)((0,n.rJ)(l.db,"events"),(0,n._M)("venueId","==",e.venueId),(0,n.My)("createdAt","desc"))}else{a([]),x(!1);return}let s=(await (0,n.GG)(t)).docs.map(e=>({id:e.id,...e.data()}));s.sort((e,t)=>Number(!!t.isFeatured)-Number(!!e.isFeatured)),a(s)}catch(e){console.error("Error loading events:",e),c.oR.error("Failed to load events: "+e.message)}finally{x(!1)}}},f=(0,i.useMemo)(()=>{let e=v.trim().toLowerCase();return e?s.filter(t=>{var s,a,r;return(null==(s=t.name)?void 0:s.toLowerCase().includes(e))||(null==(a=t.venue)?void 0:a.toLowerCase().includes(e))||(null==(r=t.description)?void 0:r.toLowerCase().includes(e))}):s},[s,v]),j=async t=>{if(!e||"siteAdmin"!==e.role)return void c.oR.error("Only site administrators can manage featured events");try{await (0,n.mZ)((0,n.H9)(l.db,"events",t.id),{isFeatured:!t.isFeatured,updatedAt:n.Dc.now()}),a(e=>e.map(e=>e.id===t.id?{...e,isFeatured:!e.isFeatured}:e)),c.oR.success("Event ".concat(t.isFeatured?"unfeatured":"featured"))}catch(e){c.oR.error(e.message||"Failed to toggle feature")}};return{user:e,authLoading:t,events:s,venues:r,loading:m,search:v,setSearch:h,filtered:f,onToggleFeatured:j,onDelete:async e=>{try{let t=await (0,n.GG)((0,n.rJ)(l.db,"events",e.id,"tickets"));if(!t.empty){let e=(0,n.wP)(l.db);t.forEach(t=>e.delete(t.ref)),await e.commit()}if(e.imageUrl)try{await (0,d.XR)((0,d.KR)(l.I,e.imageUrl))}catch(e){}await (0,n.kd)((0,n.H9)(l.db,"events",e.id)),a(t=>t.filter(t=>t.id!==e.id)),c.oR.success("Event deleted successfully")}catch(e){c.oR.error(e.message||"Failed to delete event")}},getEventStatus:e=>{var t;let s=new Date,a=new Date((null==(t=e.date)?void 0:t.seconds)*1e3),r=e.ticketsSold>=e.maxTickets;return a<s?{status:"past",label:"Past Event",variant:"secondary"}:r?{status:"soldout",label:"Sold Out",variant:"destructive"}:{status:"available",label:"Available",variant:"default"}},getTicketProgress:e=>Math.min((e.ticketsSold||0)/(e.maxTickets||1)*100,100),loadEvents:p,setEvents:a}}(),[b,N]=(0,i.useState)(!1),[w,y]=(0,i.useState)(null);return t?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e?"siteAdmin"!==e.role&&"venueAdmin"!==e.role&&"subAdmin"!==e.role?(0,a.jsx)(L,{user:e}):(0,a.jsxs)("div",{className:"space-y-6 max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Events"}),(0,a.jsx)(M,{openForm:b,setOpenForm:N,editing:w,setEditing:y,user:e,venues:r,setEvents:j})]}),(0,a.jsx)(P,{search:m,setSearch:x,events:s}),(0,a.jsx)("div",{className:"grid gap-8 md:grid-cols-2 xl:grid-cols-3",children:u?Array.from({length:6}).map((e,t)=>(0,a.jsx)(J,{},t)):0===v.length?(0,a.jsx)(G,{search:m,setOpenForm:N,userRole:e.role}):v.map((t,s)=>{let r=p(t),i=f(t);return(0,a.jsx)(O,{ev:t,index:s,eventStatus:r,ticketProgress:i,user:e,onToggleFeatured:h,onDelete:g,setEditing:y,setOpenForm:N},"event-".concat(t.id,"-").concat(s))})})]}):(0,a.jsx)(L,{user:null})}function B(){return(0,a.jsx)(r.A,{children:(0,a.jsx)(q,{})})}},76037:(e,t,s)=>{"use strict";s.d(t,{w:()=>n});var a=s(95155);s(12115);var r=s(87489),i=s(53999);function n(e){let{className:t,orientation:s="horizontal",decorative:n=!0,...l}=e;return(0,a.jsx)(r.b,{"data-slot":"separator",decorative:n,orientation:s,className:(0,i.cn)("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",t),...l})}},93751:(e,t,s)=>{Promise.resolve().then(s.bind(s,44396))},99840:(e,t,s)=>{"use strict";s.d(t,{Cf:()=>u,Es:()=>x,L3:()=>v,c7:()=>m,lG:()=>l,rr:()=>h,zM:()=>d});var a=s(95155);s(12115);var r=s(15452),i=s(54416),n=s(53999);function l(e){let{...t}=e;return(0,a.jsx)(r.bL,{"data-slot":"dialog",...t})}function d(e){let{...t}=e;return(0,a.jsx)(r.l9,{"data-slot":"dialog-trigger",...t})}function o(e){let{...t}=e;return(0,a.jsx)(r.ZL,{"data-slot":"dialog-portal",...t})}function c(e){let{className:t,...s}=e;return(0,a.jsx)(r.hJ,{"data-slot":"dialog-overlay",className:(0,n.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function u(e){let{className:t,children:s,showCloseButton:l=!0,...d}=e;return(0,a.jsxs)(o,{"data-slot":"dialog-portal",children:[(0,a.jsx)(c,{}),(0,a.jsxs)(r.UC,{"data-slot":"dialog-content",className:(0,n.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...d,children:[s,l&&(0,a.jsxs)(r.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,a.jsx)(i.A,{}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function m(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"dialog-header",className:(0,n.cn)("flex flex-col gap-2 text-center sm:text-left",t),...s})}function x(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"dialog-footer",className:(0,n.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...s})}function v(e){let{className:t,...s}=e;return(0,a.jsx)(r.hE,{"data-slot":"dialog-title",className:(0,n.cn)("text-lg leading-none font-semibold",t),...s})}function h(e){let{className:t,...s}=e;return(0,a.jsx)(r.VY,{"data-slot":"dialog-description",className:(0,n.cn)("text-muted-foreground text-sm",t),...s})}}},e=>{e.O(0,[135,965,72,822,649,503,44,441,964,358],()=>e(e.s=93751)),_N_E=e.O()}]);